name: AI Tools Pipeline

on:
  release:
    types: [published]
  workflow_dispatch:  # Allow manual trigger

env:
  PYTHON_VERSION: "3.12"

jobs:
  # ===== Job 1: Generate AI Tools =====
  generate-tools:
    name: Generate AI Agent Tools
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: ${{ env.PYTHON_VERSION }}
      
      - name: Install dependencies
        run: |
          pip install --upgrade pip
          pip install -r requirements.txt
          pip install toml pyyaml
      
      - name: Setup environment
        run: cp .env.ci .env
      
      - name: Generate AI agent tools
        run: python scripts/tools_generator.py
      
      - name: Commit and push generated tools
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          
          # Add generated tools
          git add tools/
          
          # Check if there are changes
          if git diff --staged --quiet; then
            echo "No changes to commit"
          else
            git commit -m "chore: update AI agent tools for ${{ github.event.release.tag_name }}"
            git push
          fi
      
      - name: Upload tools as release assets
        uses: softprops/action-gh-release@v1
        with:
          files: |
            tools/iam_tools.json
            tools/iam_tools.toml
            tools/iam_tools.yaml
            tools/iam_tools_mcp.json
            tools/iam_tools_langchain.json
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  
 
